- name: Perform apt-upgrade
  apt:
    upgrade: dist
    update_cache: true

- name: Install basic packages
  apt:
    update_cache: true
    state: present
    name:
      - vim
      - wget
      - curl
      - jq

- name: Remove junk packages
  apt:
    state: absent
    purge: true
    autoremove: true
    name:
      - modemmanager
      - unattended-upgrades
      - gpg-agent
      - needrestart

- name: Disable motd
  systemd:
    name: motd-news.timer
    state: stopped
    enabled: no

- name: Patch ssh pamd to disable motd
  shell:
    cmd: sed -i '/pam_motd/d' /etc/pam.d/sshd && touch /etc/ansible-pam-done
    creates: /etc/ansible-pam-done

- name: Patch ssh config to disable last log
  shell:
    cmd: sed -i 's/#PrintLastLog yes/PrintLastLog no/' /etc/ssh/sshd_config && touch /etc/ansible-ssh-done
    creates: /etc/ansible-ssh-done
  notify: Restart ssh

- name: Set correct timezone
  file:
    state: link
    src: /usr/share/zoneinfo/Europe/Moscow
    dest: /etc/localtime
